services:
  backspringboot:
    # 현재 디렉터리의 Dockerfile을 사용하여 이미지를 빌드합니다.
    build: .
    container_name: spring_backend_container
    restart: always
    ports:
      # 로컬 PC의 8080 포트와 컨테이너의 8080 포트를 연결합니다.
      - "8080:8080"
    volumes:
      # 현재 내 PC의 프로젝트 폴더 전체를 컨테이너의 /app 폴더와 동기화
      - .:/app
    # 컨테이너가 시작된 후 실행할 명령어
    command: mvn spring-boot:run
    # Spring Boot 앱에서 사용할 환경 변수를 설정합니다.
    environment:
      # DB 호스트는 다른 docker-compose의 DB 컨테이너 이름(mysql_db_container)을 사용합니다.
      DB_HOST: 'mysql_db_container' 
      DB_USER: 'root'
      DB_PASSWORD: 'asdf'
      DB_NAME: 'my_app_db'
      # 실행할 스프링 프로필을 'docker'로 지정합니다.
      SPRING_PROFILES_ACTIVE: docker
      
    # DB 서비스와 동일한 공유 네트워크를 사용하도록 설정합니다.
    networks:
      - my-shared-network

# 사용할 네트워크가 외부에서 생성된 것임을 정의합니다.
networks:
  my-shared-network:
    external: true